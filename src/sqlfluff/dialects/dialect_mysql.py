"""The MySQL dialect.

For now the only change is the parsing of comments.
https://dev.mysql.com/doc/refman/8.0/en/differences-from-ansi.html
"""

from ..parser import NamedSegment, OneOf, Ref

from .dialect_ansi import ansi_dialect

mysql_dialect = ansi_dialect.copy_as('mysql')

mysql_dialect.patch_lexer_struct([
    # name, type, pattern, kwargs
    ("inline_comment", "regex", r"(-- |#)[^\n]*", dict(is_comment=True, type="comment", trim_start=('-- ', '#')))
])

mysql_dialect.replace(
    QuotedIdentifierSegment=NamedSegment.make('back_quote', name='quoted_identifier', type='identifier', trim_chars=('`',)),
    LiteralGrammar=OneOf(
        Ref('QuotedLiteralSegment'), Ref('DoubleQuotedLiteralSegment'), Ref('NumericLiteralSegment'),
        Ref('BooleanLiteralGrammar'), Ref('QualifiedNumericLiteralSegment'), Ref('NullKeywordSegment')
    )
)

mysql_dialect.add(
    DoubleQuotedLiteralSegment=NamedSegment.make('double_quote', name='quoted_literal', type='literal', trim_chars=('"',))
)

# Unreserved Keywords
# From https://dev.mysql.com/doc/refman/8.0/en/func-op-summary-ref.html
# Removed the ones already existing in ANSI
mysql_unreserved_keywords = ansi_unreserved_keywords + """
ACOS
ADDDATE
ADDTIME
AES_DECRYPT
AES_ENCRYPT
AND
ANY_VALUE
ASCII
ASIN
ASYMMETRIC_DECRYPT
ASYMMETRIC_DERIVE
ASYMMETRIC_ENCRYPT
ASYMMETRIC_SIGN
ASYMMETRIC_VERIFY
ATAN
ATAN2
BENCHMARK
BIN
BIN_TO_UUID
BIT_AND
BIT_COUNT
BIT_OR
BIT_XOR
CAN_ACCESS_COLUMN
CAN_ACCESS_DATABASE
CAN_ACCESS_TABLE
CAN_ACCESS_VIEW
CASE
CHARSET
COERCIBILITY
CONCAT
CONCAT_WS
CONNECTION_ID
CONV
CONVERT_TZ
COS
COT
CRC32
CREATE_ASYMMETRIC_PRIV_KEY
CREATE_ASYMMETRIC_PUB_KEY
CREATE_DH_PARAMETERS
CREATE_DIGEST
CURDATE
CURTIME
DATEDIFF
DATE_ADD
DATE_FORMAT
DATE_SUB
DAYNAME
DEGREES
ELT
EXPORT_SET
ExtractValue
FIELD
FIND_IN_SET
FIRST_VALUE
FORMAT
FORMAT_BYTES
FORMAT_PICO_TIME
FOUND_ROWS
FROM_BASE64
FROM_DAYS
FROM_UNIXTIME
GET_DD_COLUMN_PRIVILEGES
GET_DD_CREATE_OPTIONS
GET_DD_INDEX_SUB_PART_LENGTH
GET_FORMAT
GET_LOCK
GROUP_CONCAT
GTID_SUBSET
GTID_SUBTRACT
GeomCollection
GeometryCollection
HEX
ICU_VERSION
IFNULL
INET6_ATON
INET6_NTOA
INET_ATON
INET_NTOA
INSTR
INTERNAL_AUTO_INCREMENT
INTERNAL_AVG_ROW_LENGTH
INTERNAL_CHECKSUM
INTERNAL_CHECK_TIME
INTERNAL_DATA_FREE
INTERNAL_DATA_LENGTH
INTERNAL_DD_CHAR_LENGTH
INTERNAL_GET_COMMENT_OR_ERROR
INTERNAL_GET_ENABLED_ROLE_JSON
INTERNAL_GET_HOSTNAME
INTERNAL_GET_USERNAME
INTERNAL_GET_VIEW_WARNING_OR_ERROR
INTERNAL_INDEX_COLUMN_CARDINALITY
INTERNAL_INDEX_LENGTH
INTERNAL_IS_ENABLED_ROLE
INTERNAL_IS_MANDATORY_ROLE
INTERNAL_KEYS_DISABLED
INTERNAL_MAX_DATA_LENGTH
INTERNAL_TABLE_ROWS
INTERNAL_UPDATE_TIME
INTERVAL
IS_FREE_LOCK
IS_IPV4
IS_IPV4_COMPAT
IS_IPV4_MAPPED
IS_IPV6
IS_USED_LOCK
IS_UUID
JSON_ARRAY
JSON_ARRAYAGG
JSON_ARRAY_APPEND
JSON_ARRAY_INSERT
JSON_CONTAINS
JSON_CONTAINS_PATH
JSON_DEPTH
JSON_EXTRACT
JSON_INSERT
JSON_KEYS
JSON_LENGTH
JSON_MERGE
JSON_MERGE_PATCH
JSON_MERGE_PRESERVE
JSON_OBJECT
JSON_OBJECTAGG
JSON_OVERLAPS
JSON_PRETTY
JSON_QUOTE
JSON_REMOVE
JSON_REPLACE
JSON_SCHEMA_VALID
JSON_SCHEMA_VALIDATION_REPORT
JSON_SEARCH
JSON_SET
JSON_STORAGE_FREE
JSON_STORAGE_SIZE
JSON_TABLE
JSON_TYPE
JSON_UNQUOTE
JSON_VALID
JSON_VALUE
LAG
LAST_DAY
LAST_VALUE
LCASE
LEAD
LEFT
LOAD_FILE
LOCATE
LOG
LOG10
LOG2
LPAD
LTRIM
LineString
MAKEDATE
MAKETIME
MAKE_SET
MASTER_POS_WAIT
MBRContains
MBRCoveredBy
MBRCovers
MBRDisjoint
MBREquals
MBRIntersects
MBROverlaps
MBRTouches
MBRWithin
MD5
MICROSECOND
MID
MultiLineString
MultiPoint
MultiPolygon
NAME_CONST
NOW
NTH_VALUE
NTILE
OCT
OR
ORD
PERIOD_ADD
PERIOD_DIFF
PI
POW
PS_CURRENT_THREAD_ID
PS_THREAD_ID
Point
Polygon
QUARTER
RADIANS
RAND
RANDOM_BYTES
REGEXP_INSTR
REGEXP_LIKE
REGEXP_REPLACE
REGEXP_SUBSTR
RELEASE_ALL_LOCKS
RELEASE_LOCK
REVERSE
RIGHT
ROLES_GRAPHML
ROUND
RPAD
RTRIM
SEC_TO_TIME
SHA
SHA1
SHA2
SIGN
SIN
SLEEP
SOUNDEX
STATEMENT_DIGEST
STATEMENT_DIGEST_TEXT
STD
STDDEV
STRCMP
STR_TO_DATE
ST_Area
ST_AsBinary
ST_AsGeoJSON
ST_AsText
ST_AsWKB
ST_AsWKT
ST_Buffer
ST_Buffer_Strategy
ST_Centroid
ST_Contains
ST_ConvexHull
ST_Crosses
ST_Difference
ST_Dimension
ST_Disjoint
ST_Distance
ST_Distance_Sphere
ST_EndPoint
ST_Envelope
ST_Equals
ST_ExteriorRing
ST_GeoHash
ST_GeomCollFromText
ST_GeomCollFromWKB
ST_GeomFromGeoJSON
ST_GeomFromText
ST_GeomFromWKB
ST_GeometryCollectionFromText
ST_GeometryCollectionFromWKB
ST_GeometryFromText
ST_GeometryFromWKB
ST_GeometryN
ST_GeometryType
ST_InteriorRingN
ST_Intersection
ST_Intersects
ST_IsClosed
ST_IsEmpty
ST_IsSimple
ST_IsValid
ST_LatFromGeoHash
ST_Latitude
ST_Length
ST_LineFromText
ST_LineFromWKB
ST_LineStringFromText
ST_LineStringFromWKB
ST_LongFromGeoHash
ST_Longitude
ST_MLineFromText
ST_MLineFromWKB
ST_MPointFromText
ST_MPointFromWKB
ST_MPolyFromText
ST_MPolyFromWKB
ST_MakeEnvelope
ST_MultiLineStringFromText
ST_MultiLineStringFromWKB
ST_MultiPointFromText
ST_MultiPointFromWKB
ST_MultiPolygonFromText
ST_MultiPolygonFromWKB
ST_NumGeometries
ST_NumInteriorRing
ST_NumInteriorRings
ST_NumPoints
ST_Overlaps
ST_PointFromGeoHash
ST_PointFromText
ST_PointFromWKB
ST_PointN
ST_PolyFromText
ST_PolyFromWKB
ST_PolygonFromText
ST_PolygonFromWKB
ST_SRID
ST_Simplify
ST_StartPoint
ST_SwapXY
ST_SymDifference
ST_Touches
ST_Transform
ST_Union
ST_Validate
ST_Within
ST_X
ST_Y
SUBDATE
SUBSTR
SUBSTRING_INDEX
SUBTIME
TAN
TIMEDIFF
TIMESTAMPADD
TIMESTAMPDIFF
TIME_FORMAT
TIME_TO_SEC
TO_BASE64
TO_DAYS
TO_SECONDS
UCASE
UNCOMPRESS
UNCOMPRESSED_LENGTH
UNHEX
UNIX_TIMESTAMP
UUID
UUID_SHORT
UUID_TO_BIN
UpdateXML
VALIDATE_PASSWORD_STRENGTH
VARIANCE
VERSION
WAIT_FOR_EXECUTED_GTID_SET
WAIT_UNTIL_SQL_THREAD_AFTER_GTIDS
WEEK
WEEKDAY
WEEKOFYEAR
WEIGHT_STRING
YEARWEEK"""

mysql_dialect.sets('unreserved_keywords').update(
    [n.strip().upper() for n in mysql_unreserved_keywords.split('\n')]
)
